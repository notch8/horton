general:
  artifacts:
    - "tmp"

machine:
  node:
    version: 6.1.0
  ruby:
    version:
      2.2.3        
  environment:
    CIRCLE_ENV: test
    RAILS_ENV: test
  java:
    version: oraclejdk8
  services:
    - redis

dependencies:
  override:
    - bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --jobs=4 --retry=3
  post:
    - bundle exec rake hydra:test_server:
        background: true  
    - sleep 10 && wget --timeout=300 --waitretry=5 --retry-connrefused -v http://localhost:8986/rest
                                 
database:
  override:
    - bundle exec rake db:migrate
        
test:
  override:         
    - bundle exec rake spec