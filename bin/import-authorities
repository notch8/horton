#!/usr/bin/env ruby

puts 'Loading environment...'
require File.expand_path('../../config/environment', __FILE__)

# import Language CVs
puts 'Start importing Language CVs ...'
File.open(File.join(Rails.root, "imports", "iso639-2.tsv"), "r") do |f|
  headers = f.gets.strip.split("\t")
  f.each do |line|
    fields = Hash[headers.zip(line.split("\t"))]

    begin
      lang = Qa::LocalAuthority.find_or_create_by(name: 'languages')
      Qa::LocalAuthorityEntry.create(
        local_authority: lang,
        label: fields["Label (English)"],
        uri: fields["URI"])
    rescue Exception => e
        # Log the error
        puts "Error create: #{lang.inspect} {label: #{fields["Label (English)"]}, uri: #{fields["URI"]}}:"
        puts  e.to_s
        e.backtrace.each do |line|
          puts line
        end
    end
  end
end
